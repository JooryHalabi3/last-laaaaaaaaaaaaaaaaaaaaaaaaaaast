<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dashboard</title>

  <link rel="stylesheet" href="report-937.css" />
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- خطوط -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tajawal:wght@400;500;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet" />
  <!-- أيقونات -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
  <!-- XLSX لقراءة الإكسل -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>

<body class="flex h-screen overflow-hidden lang-ar">
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <div class="header-title" data-ar="عُــــــونَك" data-en="AOUNAK">عُــــــونَك</div>
      <img src="/icon/hospital-logo.png" alt="شعار المستشفى" class="header-logo" />
      <button id="langToggle" class="lang-toggle-btn">
        <img src="/icon/lang.png" alt="language" class="lang-icon" />
        <span id="langText">العربية | English</span>
      </button>
    </div>
  </header>

  <!-- Sidebar -->
  <aside>
    <ul class="sidebar-menu">
      <li><a href="/login/login.html" class="menu-link" data-ar="الصفحة الرئيسية" data-en="Home Page">الصفحة الرئيسية</a></li>
      <li><a href="overview.html" class="menu-link" data-ar="نظرة عامة" data-en="Overview">نظرة عامة</a></li>
      <li><a href="report-937.html" class="menu-link active" data-ar="مؤشر بلاغات 937" data-en="937 Report Index">مؤشر بلاغات 937</a></li>
      <li><a href="misconduct.html" class="menu-link" data-ar="بلاغات سوء التعامل" data-en="Misconduct Reports">بلاغات سوء التعامل</a></li>
      <li><a href="pressganey.html" class="menu-link" data-ar="مؤشر بريسيبي" data-en="Press Ganey Index">مؤشر بريسيبي</a></li>
      <li><a href="inperson-complaints.html" class="menu-link" data-ar="مؤشر الشكاوى الحضورية" data-en="In-person Complaints">مؤشر الشكاوى الحضورية</a></li>
      <li><a href="secret-visitor.html" class="menu-link" data-ar="ملاحظات الزائر السري" data-en="Secret Visitor Notes">ملاحظات الزائر السري</a></li>
      <li><a href="general-requests.html" class="menu-link" data-ar="مؤشر الطلبات العامة" data-en="General Requests Index">مؤشر الطلبات العامة</a></li>
    </ul>
  </aside>

  <!-- Main -->
  <div id="exportArea" class="flex-1 flex flex-col p-8 overflow-auto" style="margin-right: 250px; margin-top: 75px;">

    <!-- شريط التحكم: استيراد + حفظ -->
    <div class="flex flex-wrap gap-3 items-center justify-center mb-6 no-export">
      <input id="excelInput" type="file" multiple accept=".xlsx,.xls" class="hidden" />
      <button id="importExcelBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-5 rounded-full shadow flex items-center">
        <i class="fas fa-file-excel ml-2"></i>
        <span data-ar="استيراد ملفات إكسل" data-en="Import Excel Files">استيراد ملفات إكسل</span>
      </button>

      <button id="saveLocalBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-5 rounded-full shadow flex items-center">
        <i class="fas fa-save ml-2"></i>
        <span data-ar="حفظ (محليًا)" data-en="Save (Local)">حفظ (محليًا)</span>
      </button>
    </div>

    <!-- العنوان والكارت -->
    <div class="flex justify-between items-start mb-8">
      <div class="text-left">
        <h1 class="text-2xl font-bold text-gray-800" data-ar="القسم الأكثر طلباً لتصنيفات مختلفة" data-en="Most Requested Section for Different Categories">القسم الأكثر طلباً لتصنيفات مختلفة</h1>
        <p class="text-gray-600" data-ar="مركز المعلومات الصحية" data-en="Health Information Center">مركز المعلومات الصحية</p>
      </div>
      <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center min-w-[200px]">
        <p class="text-sm text-gray-500 mb-2" data-ar="إجمالي عدد البلاغات 937" data-en="Total 937 Reports">إجمالي عدد البلاغات 937</p>
        <p class="text-4xl font-bold text-blue-600" id="totalReports">804</p>
      </div>
    </div>

    <!-- الفلاتر (شكل فقط) -->
    <div class="flex flex-wrap items-center justify-end gap-4 mb-8 no-export">
      <!-- اليوم / الأسبوع / الشهر / الربع / القسم -->
      <div class="custom-select-wrapper">
        <div class="custom-select" id="daySelect">
          <span id="selectedDay" data-ar="اختر اليوم" data-en="Choose Day">اختر اليوم</span>
          <i class="fas fa-chevron-down text-gray-500"></i>
        </div>
        <div class="custom-select-options" id="dayOptions">
          <div class="custom-select-option" data-value="today" data-ar="اليوم" data-en="Today">اليوم</div>
          <div class="custom-select-option" data-value="yesterday" data-ar="أمس" data-en="Yesterday">أمس</div>
        </div>
      </div>

      <div class="custom-select-wrapper">
        <div class="custom-select" id="weekSelect">
          <span id="selectedWeek" data-ar="اختر الأسبوع" data-en="Choose Week">اختر الأسبوع</span>
          <i class="fas fa-chevron-down text-gray-500"></i>
        </div>
        <div class="custom-select-options" id="weekOptions">
          <div class="custom-select-option" data-value="this-week" data-ar="هذا الأسبوع" data-en="This Week">هذا الأسبوع</div>
          <div class="custom-select-option" data-value="last-week" data-ar="الأسبوع الماضي" data-en="Last Week">الأسبوع الماضي</div>
        </div>
      </div>

      <div class="custom-select-wrapper">
        <div class="custom-select" id="monthSelect">
          <span id="selectedMonth" data-ar="اختر الشهر" data-en="Choose Month">اختر الشهر</span>
          <i class="fas fa-chevron-down text-gray-500"></i>
        </div>
        <div class="custom-select-options" id="monthOptions">
          <div class="custom-select-option" data-value="jan" data-ar="يناير" data-en="January">يناير</div>
          <div class="custom-select-option" data-value="feb" data-ar="فبراير" data-en="February">فبراير</div>
          <div class="custom-select-option" data-value="mar" data-ar="مارس" data-en="March">مارس</div>
        </div>
      </div>

      <div class="custom-select-wrapper">
        <div class="custom-select" id="quarterSelect">
          <span id="selectedQuarter" data-ar="اختر الربع" data-en="Choose Quarter">اختر الربع</span>
          <i class="fas fa-chevron-down text-gray-500"></i>
        </div>
        <div class="custom-select-options" id="quarterOptions">
          <div class="custom-select-option" data-value="q1" data-ar="الربع الأول" data-en="Q1">الربع الأول</div>
          <div class="custom-select-option" data-value="q2" data-ar="الربع الثاني" data-en="Q2">الربع الثاني</div>
          <div class="custom-select-option" data-value="q3" data-ar="الربع الثالث" data-en="Q3">الربع الثالث</div>
          <div class="custom-select-option" data-value="q4" data-ar="الربع الرابع" data-en="Q4">الربع الرابع</div>
        </div>
      </div>

      <div class="custom-select-wrapper">
        <div class="custom-select" id="departmentSelect">
          <span id="selectedDepartment" data-ar="اختر الإدارة/القسم" data-en="Choose Department/Section">اختر الإدارة/القسم</span>
          <i class="fas fa-chevron-down text-gray-500"></i>
        </div>
        <div class="custom-select-options" id="departmentOptions">
          <div class="custom-select-option" data-value="all" data-ar="الكل" data-en="All">الكل</div>
          <div class="custom-select-option" data-value="info-center" data-ar="مركز المعلومات" data-en="Information Center">مركز المعلومات</div>
          <div class="custom-select-option" data-value="appointments" data-ar="قسم المواعيد" data-en="Appointments Department">قسم المواعيد</div>
          <div class="custom-select-option" data-value="emergency" data-ar="قسم الطوارئ" data-en="Emergency Department">قسم الطوارئ</div>
          <div class="custom-select-option" data-value="clinics" data-ar="قسم العيادات" data-en="Clinics Department">قسم العيادات</div>
          <div class="custom-select-option" data-value="radiology" data-ar="قسم الأشعة" data-en="Radiology Department">قسم الأشعة</div>
          <div class="custom-select-option" data-value="lab" data-ar="قسم المختبر" data-en="Lab Department">قسم المختبر</div>
          <div class="custom-select-option" data-value="pharmacy" data-ar="قسم الصيدلية" data-en="Pharmacy Department">قسم الصيدلية</div>
          <div class="custom-select-option" data-value="nutrition" data-ar="قسم التغذية" data-en="Nutrition Department">قسم التغذية</div>
          <div class="custom-select-option" data-value="nursing" data-ar="قسم العلاج الطبيعي" data-en="Physical Therapy Department">قسم العلاج الطبيعي</div>
          <div class="custom-select-option" data-value="dentistry" data-ar="قسم الأسنان" data-en="Dentistry Department">قسم الأسنان</div>
        </div>
      </div>
    </div>

    <!-- الرسوم -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
      <div class="chart-container">
        <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center" data-ar="تصنيفات البلاغات الواردة حسب النطاق" data-en="Complaint Categories by Scope">تصنيفات البلاغات الواردة حسب النطاق</h2>
        <div class="relative w-full" style="height: 400px;">
          <canvas id="complaintCategoriesChart"></canvas>
        </div>
      </div>

      <div class="chart-container">
        <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center" data-ar="إجمالي البلاغات المسجلة في الإدارات - الأقسام" data-en="Total Registered Complaints in Departments - Sections">إجمالي البلاغات المسجلة في الإدارات - الأقسام</h2>
        <div class="relative w-full" style="height: 400px;">
          <canvas id="departmentComplaintsChart"></canvas>
        </div>
      </div>
    </div>

    <!-- تصدير -->
    <div class="flex justify-center mt-8 no-export">
      <button id="exportReportBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center">
        <i class="fas fa-download ml-2"></i>
        <span data-ar="تصدير التقرير" data-en="Export Report">تصدير التقرير</span>
      </button>
    </div>
  </div>

  <style>
    /* عناصر لا نريد ظهورها في ملف التصدير */
    #exportArea.exporting .no-export{ display:none !important; }
    #exportArea.exporting{ background:#fff; margin-right:0 !important; margin-top:0 !important; padding:24px !important; }
    #exportArea.exporting .mb-8{ margin-bottom:12px !important; }
    #exportArea.exporting .p-6{ padding:12px !important; }
    #exportArea.exporting .grid{ gap:12px !important; }
    #exportArea.exporting .chart-container{ page-break-inside: avoid; }
  </style>
<script>
  (function () {
    // استخدمي نفس التخزين عندك: localStorage.user يحتوي RoleID
    function redirectByRole() {
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      if (!user) return '/login/login.html';

      const roleId = Number(user.RoleID || user.roleId);
      if (roleId === 1) return '/superadmin/superadmin-home.html'; // سوبر أدمن
      if (roleId === 2) return '/employee/employee-home.html';   // موظف
      if (roleId === 3) return '/dept-admin/dept-admin.html';      // أدمن
      return '/login/login.html'; // احتياطي
    }

    // كل روابط "الصفحة الرئيسية" الموجودة في الشريط الجانبي
    const homeLinks = document.querySelectorAll(
      'aside .sidebar-menu a.menu-link[href$="/login/login.html"], aside .sidebar-menu a.menu-link[data-en="Home Page"], aside .sidebar-menu a.menu-link[data-ar="الصفحة الرئيسية"]'
    );

    homeLinks.forEach(a => {
      // خَلّي النقر يوجّه حسب الدور
      a.addEventListener('click', (e) => {
        e.preventDefault();
        window.location.href = redirectByRole();
      });

      // (اختياري) عدّلي الـ href الظاهر للـ Hover/Copy
      a.setAttribute('href', redirectByRole());
    });
  })();
</script>
  <script src="report-937.js"></script>

</body>
</html>