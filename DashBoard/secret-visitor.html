<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <!-- Tailwind CSS CDN -->
            <link rel="stylesheet" href="secret-visitor.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for Inter, Tajawal, and Merriweather -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Tajawal:wght@400;500;700&family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <!-- Chart.js Datalabels Plugin -->
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- SheetJS Library for Excel file reading -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <style>
        /* Export styles */
        .exporting .no-export {
            display: none !important;
        }
        
        .exporting {
            background: white !important;
        }
        
        .exporting * {
            color: black !important;
            background: white !important;
        }
        
        .exporting canvas {
            background: white !important;
        }
        
        @media print {
            .no-export {
                display: none !important;
            }
        }
    </style>
  
</head>
<body class="flex h-screen overflow-hidden lang-ar">

    <!-- Header (User-provided HTML) -->
    <header class="header">
        <div class="header-content">
            <!-- Placeholder for hospital-logo.png -->   
            <div class="header-title" data-ar="عُــــــونَك" data-en="AOUNAK">عُــــــونَك</div>
            <img src="/icon/hospital-logo.png" alt="شعار المستشفى" class="header-logo">

            <button id="langToggle" class="lang-toggle-btn">
                <!-- Placeholder for lang.png -->
                <img src="/icon/lang.png" alt="language" class="lang-icon" />
                <span id="langText">العربية | English</span>
            </button>
        </div>
    </header>

    <!-- Sidebar (User-provided HTML) -->
    <aside>
        <ul class="sidebar-menu">
            <li><a href="/login/home.html" class="menu-link" data-ar="الصفحة الرئيسية" data-en="Home Page">الصفحة الرئيسية</a></li>
            <li><a href="overview.html" class="menu-link" data-ar="نظرة عامة" data-en="Overview">نظرة عامة</a></li>
            <li><a href="report-937.html" class="menu-link " data-ar="مؤشر بلاغات 937" data-en="937 Report Index">مؤشر بلاغات 937</a></li> <!-- Active link changed -->
            <li><a href="misconduct.html" class="menu-link" data-ar="بلاغات سوء التعامل" data-en="Misconduct Reports">بلاغات سوء التعامل</a></li>
            <li><a href="pressganey.html" class="menu-link" data-ar="مؤشر بريسيبي" data-en="Press Ganey Index">مؤشر بريسيبي</a></li>
            <li><a href="inperson-complaints.html" class="menu-link" data-ar="مؤشر الشكاوى الحضورية" data-en="In-person Complaints">مؤشر الشكاوى الحضورية</a></li>
            <li><a href="secret-visitor.html" class="menu-link active" data-ar="ملاحظات الزائر السري" data-en="Secret Visitor Notes">ملاحظات الزائر السري</a></li>
            <li><a href="general-requests.html" class="menu-link" data-ar="مؤشر الطلبات العامة" data-en="General Requests Index">مؤشر الطلبات العامة</a></li>
        </ul>
    </aside>

    <!-- Main Content Area -->
    <div id="exportArea" class="flex-1 flex flex-col p-8 overflow-auto" style="margin-right: 250px; margin-top: 75px;">
        
        <!-- شريط تحكم: زر استيراد + زر حفظ + زر اختبار -->
        <div class="flex flex-wrap gap-3 items-center justify-center mb-6">
            <input id="excelInput" type="file" multiple accept=".xlsx,.xls" class="hidden">
            <button id="importExcelBtn" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-5 rounded-full shadow flex items-center">
                <i class="fas fa-file-excel ml-2"></i>
                <span data-ar="استيراد ملفات إكسل" data-en="Import Excel Files">استيراد ملفات إكسل</span>
            </button>



            <button id="saveToServerBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-5 rounded-full shadow flex items-center">
                <i class="fas fa-save ml-2"></i>
                <span data-ar="حفظ (محليًا)" data-en="Save (Local)">حفظ (محليًا)</span>
            </button>
        </div>



        <!-- Top Cards Section -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Card 1: Total Observation Locations -->
            <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
                <p class="text-sm text-gray-500 mb-2" data-ar="إجمالي عدد مواقع الملاحظات" data-en="Total Observation Locations">إجمالي عدد مواقع الملاحظات</p>
                <p class="text-4xl font-bold text-blue-600" id="totalObservationLocations">5</p>
            </div>
            <!-- Card 2: Total Responsible Departments -->
            <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
                <p class="text-sm text-gray-500 mb-2" data-ar="إجمالي عدد الإدارات المسؤولة" data-en="Total Responsible Departments">إجمالي عدد الإدارات المسؤولة</p>
                <p class="text-4xl font-bold text-green-600" id="totalResponsibleDepartments">13</p>
            </div>
            <!-- Card 3: Total Secret Visitor Notes -->
            <div class="bg-white rounded-lg shadow-md p-6 flex flex-col items-center justify-center text-center">
                <p class="text-sm text-gray-500 mb-2" data-ar="إجمالي عدد ملاحظات الزائر السري" data-en="Total Secret Visitor Notes">إجمالي عدد ملاحظات الزائر السري</p>
                <p class="text-4xl font-bold text-purple-600" id="totalSecretVisitorNotes">44</p>
            </div>
        </div>

        <!-- Dropdown Section -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h3 class="text-lg font-semibold text-gray-800 mb-4" data-ar="اختر القسم لعرض تفاصيله" data-en="Choose Department to View Details">اختر القسم لعرض تفاصيله</h3>
            <div class="custom-select-wrapper">
                <div class="custom-select" id="departmentSelect">
                    <span id="selectedDepartment" data-ar="الكل" data-en="All">الكل</span>
                    <i class="fas fa-chevron-down text-gray-500"></i>
                </div>
                <div class="custom-select-options" id="departmentOptions">
                    <div class="custom-select-option" data-value="dental-center" data-ar="مركز الاسنان" data-en="Dental Center">مركز الاسنان</div>
                    <div class="custom-select-option" data-value="emergency" data-ar="الطوارئ" data-en="Emergency">الطوارئ</div>
                    <div class="custom-select-option" data-value="corridors" data-ar="الممرات" data-en="Corridors">الممرات</div>
                    <div class="custom-select-option" data-value="outpatient" data-ar="العيادات الخارجية" data-en="Outpatient Clinics">العيادات الخارجية</div>
                    <div class="custom-select-option" data-value="inpatient" data-ar="التنويم" data-en="Inpatient">التنويم</div>
                </div>
            </div>
        </div>

        <!-- Charts Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <!-- Left Chart: Horizontal Bar Chart -->
            <div class="bg-white rounded-lg shadow-md p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center" data-ar="ملاحظات الزائر السري حسب القسم و حالة التنفيذ" data-en="Secret Visitor Notes by Department and Execution Status">ملاحظات الزائر السري حسب القسم و حالة التنفيذ</h2>
                <div class="flex justify-center items-center mb-4">
                    <div class="flex items-center ml-4">
                        <span class="w-4 h-4 rounded-full bg-green-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" data-ar="منفذ" data-en="Executed">منفذ</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-4 h-4 rounded-full bg-red-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" data-ar="غير منفذ" data-en="Not Executed">غير منفذ</span>
                    </div>
                </div>
                <div class="relative w-full" style="height: 350px;">
                    <canvas id="horizontalBarChart"></canvas>
                </div>
            </div>

                         <!-- Right Chart: Donut Chart -->
             <div class="bg-white rounded-lg shadow-md p-6">
                 <h2 class="text-xl font-semibold text-gray-800 mb-6 text-center" data-ar="ملاحظات الزائر السري حسب القسم" data-en="Secret Visitor Notes by Department">ملاحظات الزائر السري حسب القسم</h2>
                <div class="relative w-full" style="height: 350px;">
                    <canvas id="donutChart"></canvas>
                </div>
                <!-- Donut Chart Legend (Custom HTML, Chart.js legend disabled) -->
                <div class="flex flex-wrap justify-center gap-4 mt-4">
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-blue-600 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="dental-center-legend" data-ar="مركز الاسنان" data-en="Dental Center">مركز الاسنان</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-red-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="emergency-legend" data-ar="الطوارئ" data-en="Emergency">الطوارئ</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-gray-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="corridors-legend" data-ar="الممرات" data-en="Corridors">الممرات</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-green-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="outpatient-legend" data-ar="العيادات الخارجية" data-en="Outpatient Clinics">العيادات الخارجية</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-3 h-3 rounded-full bg-purple-500 ml-2"></span>
                        <span class="text-gray-700 text-sm" id="inpatient-legend" data-ar="التنويم" data-en="Inpatient">التنويم</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- جدول البيانات المرفوعة من Excel (مخفي افتراضياً) -->
        <div id="excelDataTableContainer" class="bg-white rounded-lg shadow-md p-6 mb-8 hidden">
            <h3 class="text-lg font-semibold text-gray-800 mb-4" data-ar="بيانات القسم المختار" data-en="Selected Department Data">بيانات القسم المختار</h3>
            <div class="overflow-x-auto">
                <table id="excelDataTable" class="min-w-full bg-white border border-gray-300">
                    <thead class="bg-gray-50">
                        <tr>
                                                         <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="القسم" data-en="Department" id="mainDeptHeader">القسم</th>
                                                         <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="الملاحظة" data-en="Notes" id="mainNoteHeader">الملاحظة</th>
                             <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="الإدارة المسؤولة" data-en="Responsible Department" id="mainRespDeptHeader">الإدارة المسؤولة</th>
                             <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="حالة التنفيذ" data-en="Execution Status" id="mainStatusHeader">حالة التنفيذ</th>
                             <th class="px-6 py-3 border-b border-gray-200 text-right text-xs leading-4 font-medium text-gray-500 uppercase tracking-wider" data-ar="الإجراءات" data-en="Actions" id="mainActionsHeader">الإجراءات</th>
                        </tr>
                    </thead>
                    <tbody id="excelDataTableBody" class="bg-white">
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-gray-500" data-ar="اختر قسم من القائمة أعلاه لعرض بياناته" data-en="Select a department from the list above to view its data">اختر قسم من القائمة أعلاه لعرض بياناته</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- زر التصدير -->
        <div class="flex justify-center mt-8 no-export">
            <button id="exportReportBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded-full shadow-lg flex items-center">
                <i class="fas fa-download ml-2"></i>
                <span data-ar="تصدير التقرير" data-en="Export Report">تصدير التقرير</span>
            </button>
        </div>
    </div>



    <!-- AI Insights Modal -->
    <div id="aiInsightsModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden modal-overlay">
        <div class="bg-white p-8 rounded-lg shadow-xl max-w-lg w-full mx-4 relative modal-content">
            <button id="closeModalBtn" class="absolute top-4 left-4 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
            <h3 class="text-xl font-semibold text-gray-800 mb-4" data-ar="رؤى وتحليلات الذكاء الاصطناعي" data-en="AI Insights and Analysis">رؤى وتحليلات الذكاء الاصطناعي</h3>
            <div id="aiInsightsContent" class="text-gray-700 text-base leading-relaxed">
                <!-- AI generated content will be loaded here -->
                <div id="aiLoadingSpinner" class="flex justify-center items-center py-8 hidden">
                    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"></div>
                </div>
            </div>
        </div>
    </div>
<script>
  (function () {
    // استخدمي نفس التخزين عندك: localStorage.user يحتوي RoleID
    function redirectByRole() {
      const user = JSON.parse(localStorage.getItem('user') || 'null');
      if (!user) return '/login/home.html';

      const roleId = Number(user.RoleID || user.roleId);
      if (roleId === 1) return '/superadmin/superadmin-home.html'; // سوبر أدمن
      if (roleId === 2) return '/employee/employee-home.html';   // موظف
      if (roleId === 3) return '/dept-admin/dept-admin.html';      // أدمن
      return '/login/home.html'; // احتياطي
    }

    // كل روابط "الصفحة الرئيسية" الموجودة في الشريط الجانبي
    const homeLinks = document.querySelectorAll(
      'aside .sidebar-menu a.menu-link[href$="/login/home.html"], aside .sidebar-menu a.menu-link[data-en="Home Page"], aside .sidebar-menu a.menu-link[data-ar="الصفحة الرئيسية"]'
    );

    homeLinks.forEach(a => {
      // خَلّي النقر يوجّه حسب الدور
      a.addEventListener('click', (e) => {
        e.preventDefault();
        window.location.href = redirectByRole();
      });

      // (اختياري) عدّلي الـ href الظاهر للـ Hover/Copy
      a.setAttribute('href', redirectByRole());
    });
  })();
</script>
    <script src="secret-visitor.js"></script>
</body>
</html>